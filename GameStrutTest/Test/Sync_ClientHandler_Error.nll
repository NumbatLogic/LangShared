namespace NumbatLogic
{
	class Sync_ClientHandler_Error_Server : gsServer
	{
		public construct(string sxAddress, Uint16 nPort, Uint16 nVersion, string sxDatabasePath) : base (sxAddress, nPort, nVersion, sxDatabasePath)
		{
		}

		public override gsServerClient** OnCreateServerClient(Uint32 nClientId, gsClientSocket pClientSocket, gsServer pServer)
		{
			return new Sync_ClientHandler_Error_ServerClient(nClientId, pClientSocket, pServer);
		}
	}

	class Sync_ClientHandler_Error_ServerClient : gsServerClient
	{
		public construct(Uint32 nClientId, gsClientSocket pClientSocket, gsServer pServer) : base (nClientId, pClientSocket, pServer)
		{
		}

		public override void OnInitialJoin()
		{
			gsServerRoom* pRoom = own new gsServerRoom(1234, "Sync_ClientHandler_Error_Room", __pServer);
			gsBlob* pBlob = own new gsBlob();
			Send(pRoom, tthash("Dummy"), pBlob);
		}
	}

	class Sync_ClientHandler_Error
	{
		public static void Run()
		{
			gsServer* pServer = own new Sync_ClientHandler_Error_Server("localhost", 9878, 0, "");
			gsClient* pClient = own new gsClient("localhost", 9878, 0);

			GameStrutTestUtil::Update(pServer, pClient);
			Assert::Plz(pClient.__eState == gsClient::State::ERRORED);
			Assert::Plz(!pClient.__pClientSocket.GetConnected());
		}
	}
}
